<section class="container-invitation">
  <div class="content-invitation">
    <div class="invitation-image-container">
      <figure class="relative">
        <!-- Se estiver carregando, mostra apenas o spinner -->
        <img
          *ngIf="!isLoading"
          [src]="urlImg()"
          alt="Imagem do convite"
          class="invitation-image"
        />

        <!-- Ícone de Loading no Centro -->
        <div *ngIf="isLoading" class="loading-overlay">
          <fa-icon [icon]="spinnerIcon" size="3x"></fa-icon>
          <p>Loading ....</p>
        </div>

        <!-- Botão para trocar imagem -->
        <button (click)="getImg()" class="btn-change-img" title="Trocar Imagem">
          <fa-icon
            [icon]="changeIcon"
            aria-label="btn para mudar imagem"
          ></fa-icon>
        </button>
      </figure>
    </div>

    <!-- Form -->
    <div class="invitation-form-container">
      <h2>Criar Novo Convite</h2>
      <form
        [formGroup]="invitationForm"
        (ngSubmit)="onSubmit()"
        aria-label="formulario para criar um convite"
      >
        <div class="form-row">
          <div class="form-group half">
            <label for="name">Nome:</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              class="form-control"
            />
            <div
              *ngIf="
                invitationForm.controls['name'].invalid &&
                invitationForm.controls['name'].touched
              "
              class="error-message"
            >
              <small
                *ngIf="invitationForm.controls['name'].errors?.['required']"
                >Nome é obrigatório.</small
              >
              <small
                *ngIf="invitationForm.controls['name'].errors?.['minlength']"
                >Nome deve ter pelo menos 3 caracteres.</small
              >
            </div>
          </div>

          <div class="form-group half">
            <label for="age">Idade:</label>
            <input
              type="number"
              id="age"
              formControlName="age"
              class="form-control"
            />
            <div
              *ngIf="
                invitationForm.controls['age'].invalid &&
                invitationForm.controls['age'].touched
              "
              class="error-message"
            >
              <small *ngIf="invitationForm.controls['age'].errors?.['required']"
                >Idade é obrigatória.</small
              >
              <small *ngIf="invitationForm.controls['age'].errors?.['min']"
                >Idade mínima é 1.</small
              >
              <small *ngIf="invitationForm.controls['age'].errors?.['max']"
                >Idade máxima é 120.</small
              >
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group half">
            <label for="phone">Telefone:</label>
            <input
              type="text"
              id="phone"
              formControlName="phone"
              class="form-control"
            />
            <div
              *ngIf="
                invitationForm.controls['phone'].invalid &&
                invitationForm.controls['phone'].touched
              "
              class="error-message"
            >
              <small
                *ngIf="invitationForm.controls['phone'].errors?.['required']"
                >Telefone é obrigatório.</small
              >
              <small
                *ngIf="invitationForm.controls['phone'].errors?.['pattern']"
                >Telefone inválido (deve ter 10 ou 11 dígitos).</small
              >
            </div>
          </div>

          <div class="form-group half">
            <label for="email">Email:</label>
            <input
              type="email"
              id="email"
              formControlName="email"
              class="form-control"
            />
            <div
              *ngIf="
                invitationForm.controls['email'].invalid &&
                invitationForm.controls['email'].touched
              "
              class="error-message"
            >
              <small
                *ngIf="invitationForm.controls['email'].errors?.['required']"
                >'Email' é obrigatório.</small
              >
              <small *ngIf="invitationForm.controls['email'].errors?.['email']"
                >Formato de email inválido.</small
              >
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group three-quarters">
            <label for="address">Endereço:</label>
            <input
              type="text"
              id="address"
              formControlName="address"
              class="form-control"
            />
            <div
            *ngIf="
              invitationForm.controls['address'].invalid &&
              invitationForm.controls['address'].touched
            "
            class="error-message"
          >
            <small
              *ngIf="invitationForm.controls['address'].errors?.['required']"
              >'Endereço' é obrigatório.</small
            >
            <small *ngIf="invitationForm.controls['address'].errors?.['address']"
              >Formato de Endereço inválido.</small
            >
          </div>
          </div>

          <div class="form-group quarter">
            <label for="number">Número:</label>
            <input
              type="text"
              id="number"
              formControlName="number"
              class="form-control"
            />
            <div
            *ngIf="
              invitationForm.controls['number'].invalid &&
              invitationForm.controls['number'].touched
            "
            class="error-message"
          >
            <small
              *ngIf="invitationForm.controls['number'].errors?.['required']"
              >'number' é obrigatório.</small
            >
            <small *ngIf="invitationForm.controls['number'].errors?.['number']"
              >Formato de Numero inválido.</small
            >
          </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group half">
            <label for="neighborhood">Bairro:</label>
            <input
              type="text"
              id="neighborhood"
              formControlName="neighborhood"
              class="form-control"
            />
             <div
              *ngIf="
                invitationForm.controls['neighborhood'].invalid &&
                invitationForm.controls['neighborhood'].touched
              "
              class="error-message"
            >
              <small
                *ngIf="invitationForm.controls['neighborhood'].errors?.['required']"
                >'Bairro' é obrigatório.</small
              >
              <small *ngIf="invitationForm.controls['neighborhood'].errors?.['neighborhood']"
                >Formato de Bairro inválido.</small
              >
            </div>
          </div>

          <div class="form-group half">
            <label for="city">Cidade:</label>
            <input
              type="text"
              id="city"
              formControlName="city"
              class="form-control"
            />
            <div
            *ngIf="
              invitationForm.controls['city'].invalid &&
              invitationForm.controls['city'].touched
            "
            class="error-message"
          >
            <small
              *ngIf="invitationForm.controls['city'].errors?.['required']"
              >'Cidade' é obrigatório.</small
            >
            <small *ngIf="invitationForm.controls['city'].errors?.['city']"
              >Formato de Cidade inválido.</small
            >
          </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group half">
            <label for="date">Data do Evento:</label>
            <input
              type="date"
              id="date"
              formControlName="date"
              class="form-control"
            />
            <div
              *ngIf="
                invitationForm.controls['date'].invalid &&
                invitationForm.controls['date'].touched
              "
              class="error-message"
            >
              <small>Data é obrigatória.</small>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="message">Mensagem do Convite:</label>
          <textarea
            id="message"
            formControlName="message"
            class="form-control textarea"
          ></textarea>
          <div
            *ngIf="
              invitationForm.controls['message'].invalid &&
              invitationForm.controls['message'].touched
            "
            class="error-message"
          >
            <small
              *ngIf="invitationForm.controls['message'].errors?.['required']"
              >Mensagem é obrigatória.</small
            >
            <small
              *ngIf="invitationForm.controls['message'].errors?.['minlength']"
              >Mínimo de 10 caracteres.</small
            >
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            [disabled]="invitationForm.invalid"
            class="btn-submit"
          >
            Gerar Convite
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" aria-label="Preview do convite">
    <div class="modal">
      <div class="modal-header">
        <h2>Convite Gerado</h2>
        <button
          (click)="closeModal()"
          class="btn-close"
          aria-label="Fechar modal"
        >
          ×
        </button>
      </div>

      <div class="modal-body">
        <div class="invitation-preview">
          <div class="invitation-header">
            <p class="invite-title">Você está convidado</p>
          </div>

          <div class="invitation-content">
            <img
              [src]="invitationData?.image || 'assets/default-avatar.png'"
              alt="Foto do Aniversariante"
              class="invite-img"
            />

            <div class="invitation-data">
              <p><strong>     <fa-icon
                [icon]="phoneIcon"
                aria-label="icons phone"
              ></fa-icon> Telefone:</strong> {{ invitationData?.phone }}</p>
              <p>
                <strong> <fa-icon
                  [icon]="emailIcon"
                  aria-label="icons phone"
                ></fa-icon> Email Para contato:</strong> {{ invitationData?.email }}
              </p>
              <p>
                <strong> <fa-icon [icon]="mapIcon"></fa-icon> Endereço:</strong> {{ invitationData?.address }},
                {{ invitationData?.address_number }}
                {{ invitationData?.neighborhood }}, {{ invitationData?.city }}
              </p>
              <p>
                <strong>Data do evento:</strong>
                {{ invitationData?.date | date : "dd/MM/yyyy" }}
              </p>

              <p ><strong>Mensagem:</strong> </p>
                <div class="modal-msg">
                  <p>{{ invitationData?.message }}</p>
                </div>
            </div>
          </div>
          <p class="rsvp">Por favor, confirme presença.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button (click)="editInvitation()" class="btn-edit">Editar</button>
        <button (click)="sendInvitation()" class="btn-send">
          Enviar Convite
        </button>
      </div>
    </div>
  </div>
</section>
